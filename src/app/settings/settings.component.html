<div class="container">
    <h1>Account settings</h1>

    <form [formGroup]="emailForm" class="info">
        <span>Email:</span>
        <div class="current-info">
            <input #emailAddress id="emailAddress" [class.error]="emailError && (emailField?.dirty || emailField?.touched)" 
            [(ngModel)]="email" [readonly]="isReadOnly" maxlength="30" type="text" name="email" formControlName="email" required>
            <button (click)="changeInfo('emailAddress')" *ngIf="email == currentEmail">
                <fa-icon [icon]="faEdit" />
            </button>
            <button (click)="saveInfo('email')" *ngIf="email != currentEmail" [disabled]="!emailForm.valid"><fa-icon [icon]="faSave"/></button>
        </div>
    </form>
    <div class="error-message">
        <div *ngIf="emailField?.errors?.['required']">
            This field is required.
        </div>
        <div *ngIf="emailField?.errors?.['email']">
            This is not a valid email address.
        </div>
        <div>{{emailError}}</div>
    </div>

    <form [formGroup]="usernameForm" class="info">
        <span>Username:</span>
        <div class="current-info">
            <input id="username" [class.error]="usernameError && (usernameField?.dirty || usernameField?.touched)" 
            [(ngModel)]="username" [readonly]="isReadOnly" maxlength="20" type="text" name="username" formControlName="username" required>
            <button (click)="changeInfo('username')" *ngIf="username == currentUsername">
                <fa-icon [icon]="faEdit" />
            </button>
            <button (click)="saveInfo('username')" *ngIf="username != currentUsername" [disabled]="!usernameForm.valid"><fa-icon [icon]="faSave"/></button>
        </div>
    </form>
    <div class="error-message">
        <div *ngIf="usernameField?.errors?.['minlength']">Username should at least contain 5 characters</div>
        <div *ngIf="usernameField?.errors?.['required']">This field is required.</div>
        <div>{{usernameError}}</div>
    </div>

    <button class="reset-password-btn" (click)="togglePasswordForm()">Reset Password</button>
    <form [formGroup]="passwordForm" class="password-form" *ngIf="displayPasswordForm"  (submit)="resetPassword()">
        <label>Old Password:</label>
        <input type="password" name="oldPassword" formControlName="oldPassword" [class.error]="oldPassword?.invalid && (oldPassword?.dirty || oldPassword?.touched) || passwordError" required/>
        <div class="error-message">
            <div *ngIf="oldPassword?.errors?.['required']">This field is required.</div>
        </div>
    
        <label>New Password:</label>
        <input type="password" name="newPassword" formControlName="newPassword" [class.error]="newPassword?.invalid && (newPassword?.dirty || newPassword?.touched) || passwordError"  required/>
        <div class="error-message">
            <div *ngIf="newPassword?.errors?.['required']">This field is required.</div>
            <div *ngIf="newPassword?.errors?.['required'] == null" >{{passwordError}}</div>
        </div>

        <button type="submit" [disabled]="!passwordForm.valid">Save</button>
    </form>     
</div>